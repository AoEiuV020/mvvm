# 多模块结构约束

## SDK 模块（按技术职责拆分）

| 模块 | 职责 | 依赖 |
|------|------|------|
| `sdk-api` | 公共接口定义、数据模型 | 无 |
| `sdk-tcp` | TCP 长连接管理 | sdk-api |
| `sdk-http` | HTTP 请求 | sdk-api |
| `sdk-db` | 本地数据库 | sdk-api |
| `sdk` | 聚合模块，统一入口 | 以上所有 |

依赖关系：`sdk → sdk-tcp, sdk-http, sdk-db → sdk-api`

---

## UI 模块架构

### 分层结构

```
                    app（主应用）
                       ↓
                   sdkui（组装层）
        ↙     ↙     ↓     ↘     ↘
   login  chat  conversation  emoji  group ...（功能模块）
        ↘     ↘     ↓     ↙     ↙
                ui-core（核心层）
                   ↓      ↓
                sdk-api  uikit
```

### 模块职责

| 模块 | 职责 |
|------|------|
| `uikit` | 纯 UI 组件库（无业务逻辑） |
| `ui-core` | **核心层**：功能接口定义 + 公共 SDK Providers |
| `login` | **功能模块**：登录/注册页面 |
| `chat` | **页面模块**：聊天页面 |
| `conversation` | **页面模块**：会话列表页面 |
| `emoji` | **嵌入式组件模块**：Emoji 功能 |
| `group` | **页面模块**：群组页面 |
| `sdkui` | **组装层**：统一路由配置，重新导出所有模块 |
| `app` | 主应用入口，初始化和配置 |

### 模块分类

| 类型 | 说明 | 组装方式 |
|------|------|----------|
| **页面模块** | 独立页面（login/chat/group） | 路由配置 |
| **嵌入式组件模块** | 在其他页面内嵌入（emoji/voice） | 接口注入 |

### 依赖方向

```
app → sdkui → 功能模块 → ui-core → sdk-api, uikit
```

**关键约束：**
- `ui-core` 包含：嵌入式组件接口 + 公共 SDK Providers
- 页面模块直接导出 Page，由 sdkui 路由引用
- 嵌入式组件模块实现 ui-core 接口
- 功能模块之间不得相互依赖

---

## 核心层（ui-core）

包含嵌入式组件接口和公共 SDK Providers：

```
ui-core/
  interfaces/
    emoji_provider       # IEmojiProvider（Emoji 面板接口）
    voice_recorder_provider # IVoiceRecorderProvider（语音录制接口）
  providers/
    sdk_providers        # SDK 实例 Provider，供所有模块使用
```

**注意：页面模块（login/chat/group）不需要接口，通过路由组装。**

---

## 页面模块结构

每个功能模块实现对应接口：

```
login/
  login_page             # 登录页面
  register_page          # 注册页面
  login_viewmodel        # ViewModel

chat/
  chat_page              # 聊天页面
  chat_viewmodel         # ViewModel
```

## 嵌入式组件模块结构

```
emoji/
  emoji_provider_impl    # 实现 IEmojiProvider
  emoji_panel            # Emoji 选择面板

voice/
  voice_recorder_impl    # 实现 IVoiceRecorderProvider
  voice_recorder         # 录音组件
```

---

## 组装层（sdkui）

组装层负责：
1. **统一路由配置**：定义所有页面模块的路由
2. **重新导出**：导出 ui-core 和所有功能模块的公共 API

```
sdkui/
  router/
    app_router           # 统一路由配置
  sdkui                  # 导出所有模块
```

---

## 页面跳转

各模块通过路由路径跳转，不直接引用目标页面类：

- 模块跳转使用路径如 `/group/{id}/settings`
- 不产生模块间代码依赖
- 路由配置统一在 sdkui 层

---

## 数据模型共享

共享模型定义在 sdk-api 模块：

- 所有数据模型定义在 sdk-api
- ui-core 和功能模块都依赖 sdk-api
- 通过接口类型传递数据，不直接依赖实现

---

## 禁止的依赖关系

- `ui-core` 不包含页面实现，仅接口定义 + 公共 Providers
- 功能模块之间不得相互依赖
- sdk 实现模块（tcp/http/db）之间不得相互依赖
- `sdkui` 不包含业务代码，仅负责组装
