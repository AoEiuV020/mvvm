# 登录页面

## 功能描述

用户通过区号、手机号和密码登录系统，成功后进入数据同步页。

---

## UI 布局

- Logo/应用名称
- 区号选择器
- 手机号输入框
- 密码输入框（带显示/隐藏切换）
- 登录按钮
- 忘记密码链接
- 注册账号链接

---

## Model 层

### 依赖 SDK

使用 `IAuthService.login()` 执行 HTTP 登录。

详见 [SDK 认证模块](../../SDK/认证模块.md)。

### 表单校验规则

| 字段 | 校验规则 | 错误提示 |
|------|----------|----------|
| 手机号 | 非空 | "请输入手机号" |
| 手机号 | 11位数字 | "手机号格式错误" |
| 密码 | 非空 | "请输入密码" |
| 密码 | 至少6位 | "密码至少6位" |

校验逻辑由 Validator 类实现，具体代码见各框架文档。

---

## ViewModel 层

### 接口定义

```dart
abstract class ILoginViewModel {
  // 状态
  String get countryCode;
  String get phone;
  String? get phoneError;
  String get password;
  String? get passwordError;
  bool get isPasswordVisible;
  bool get isLoading;
  String? get errorMessage;
  bool get isLoginEnabled;
  
  // 操作
  void setCountryCode(String value);
  void setPhone(String value);
  void setPassword(String value);
  void togglePasswordVisibility();
  Future<bool> login();
  void clearError();
}
```

### 状态说明

| 状态 | 说明 |
|------|------|
| `countryCode` | 区号（如 "+86"） |
| `phone` | 手机号输入 |
| `phoneError` | 手机号校验错误（由 Validator 返回） |
| `password` | 密码输入 |
| `passwordError` | 密码校验错误（由 Validator 返回） |
| `isPasswordVisible` | 密码是否可见 |
| `isLoading` | 是否正在登录 |
| `errorMessage` | 登录错误提示 |
| `isLoginEnabled` | 无校验错误且字段非空时为 true |

### 行为逻辑

**setPhone(value)：**
1. 更新 phone 值
2. 调用 Validator 校验，更新 phoneError

**login()：**
1. 设置 `isLoading = true`
2. 调用 `IAuthService.login(countryCode, phone, password)`
3. 成功：返回 true
4. 失败：设置 `errorMessage`，返回 false
5. 最终：设置 `isLoading = false`

**错误映射：**
- `invalidCredentials` → "手机号或密码错误"
- `userNotFound` → "用户不存在"
- `networkError` → "网络连接失败"
- `serverError` → "服务器错误"

---

## View 层

### 职责

- 渲染登录表单
- 绑定 ViewModel 状态
- 调用 ViewModel 方法处理用户操作
- 登录成功后导航到数据同步页

### 用户交互

1. 选择区号 → `setCountryCode()`
2. 输入手机号 → `setPhone()`
3. 输入密码 → `setPassword()`
4. 点击眼睛图标 → `togglePasswordVisibility()`
5. 点击登录 → `login()` → 成功则导航到数据同步页
6. 点击注册 → 导航到注册页
7. 点击忘记密码 → 导航到忘记密码页
