# Flutter 路由导航

## 路由统一管理原则

所有路由定义在 sdkui 层，各功能模块只提供页面 Widget。

跳转使用路径字符串，不直接引用目标页面类，因此不产生模块间依赖。

## 路由配置（sdkui 层）

sdkui 作为组装层，统一配置所有功能模块的路由：

```dart
// im_sdkui/lib/src/router/app_router.dart

final appRouterProvider = Provider<GoRouter>((ref) {
  return GoRouter(
    initialLocation: '/login',
    redirect: (context, state) {
      // 登录状态检查和重定向逻辑
    },
    routes: [
      // login 模块
      GoRoute(path: '/login', builder: (_, __) => const LoginPage()),
      GoRoute(path: '/register', builder: (_, __) => const RegisterPage()),
      
      // conversation 模块
      GoRoute(path: '/conversations', builder: (_, __) => const ConversationListPage()),
      
      // chat 模块
      GoRoute(
        path: '/chat/:conversationId',
        builder: (_, state) => ChatPage(
          conversationId: state.pathParameters['conversationId']!,
        ),
      ),
      
      // group 模块
      GoRoute(
        path: '/group/:groupId/settings',
        builder: (_, state) => GroupSettingsPage(
          groupId: state.pathParameters['groupId']!,
        ),
      ),
    ],
  );
});
```

## App 配置

app 层只需使用 sdkui 提供的路由：

```dart
class MyApp extends ConsumerWidget {
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    return MaterialApp.router(routerConfig: ref.watch(appRouterProvider));
  }
}
```

## 导航方法

```dart
context.go('/conversations');       // 跳转
context.go('/chat/xxx');            // 带参数
context.push('/profile');           // push（可返回）
context.pop();                      // 返回
```

## 复杂参数传递

需要传递复杂对象时，使用 `extra` 参数。**参数类型定义在 sdk-api 模块**，避免模块间循环依赖。

```dart
// sdk-api 定义导航参数类
@freezed
abstract class GroupNavParams with _$GroupNavParams {
  const factory GroupNavParams({
    required String groupId,
    GroupInfo? groupInfo,
  }) = _GroupNavParams;
}
```

```dart
// 功能模块跳转时传递
context.push('/group/settings', extra: GroupNavParams(groupId: id, groupInfo: info));
```

```dart
// sdkui 层路由配置接收
GoRoute(
  path: '/group/settings',
  builder: (_, state) {
    final params = state.extra as GroupNavParams;
    return GroupSettingsPage(
      groupId: params.groupId,
      groupInfo: params.groupInfo,
    );
  },
),
```
