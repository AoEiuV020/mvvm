# Flutter 测试规范

## ViewModel 单元测试

```dart
@GenerateMocks([IAuthService])
void main() {
  late MockIAuthService mockService;
  late ProviderContainer container;
  
  setUp(() {
    mockService = MockIAuthService();
    container = ProviderContainer(
      overrides: [authServiceProvider.overrideWithValue(mockService)],
    );
  });
  
  tearDown(() => container.dispose());
  
  test('xxx', () async {
    when(mockService.action()).thenAnswer((_) async => Result(success: true));
    
    final vm = container.read(xxxViewModelProvider.notifier);
    final result = await vm.doAction();
    
    expect(result, true);
    expect(container.read(xxxViewModelProvider).isLoading, false);
  });
}
```

## Widget 测试

```dart
testWidgets('xxx', (tester) async {
  await tester.pumpWidget(
    ProviderScope(
      overrides: [xxxServiceProvider.overrideWithValue(MockXxx())],
      child: MaterialApp(home: XxxPage()),
    ),
  );
  
  expect(find.byType(XxxWidget), findsOneWidget);
});
```

## Mock 生成

使用 mockito，运行 `dart run build_runner build` 生成 mock 类和 riverpod 代码。
