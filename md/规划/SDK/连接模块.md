# 连接模块

所属模块：`sdk-tcp`

## 接口定义

```dart
abstract class IConnectionService {
  /// 建立 TCP 连接并登录，失败抛 ConnectException
  Future<void> connect();
  
  /// 断开连接
  Future<void> disconnect();
  
  /// 当前连接状态
  ConnectionState get state;
  
  /// 连接状态流
  Stream<ConnectionState> get stateStream;
}
```

---

## 数据类型

```dart
enum ConnectionState {
  disconnected,
  connecting,
  connected,
  reconnecting,
}

class ConnectException implements Exception {
  final ConnectError error;
  ConnectException(this.error);
}

enum ConnectError {
  tokenExpired,
  authFailed,
  networkError,
  serverError,
}
```

---

## 使用示例

```dart
// 监听连接状态
connectionService.stateStream.listen((state) {
  // 更新 UI 连接状态指示器
});

// 建立连接（使用 AuthService 中保存的 token）
try {
  await connectionService.connect();
} on ConnectException catch (e) {
  // 处理错误：e.error
}
```

---

## 说明

- 数据同步完成后调用
- 使用 SDK 内部保存的 token 和 userId 进行 TCP 登录（登录时由 AuthService 保存）
- 自动重连由 SDK 内部处理
- 重连时触发 stateStream 更新
- 自动重连由 SDK 内部处理
- 重连时触发 stateStream 更新
