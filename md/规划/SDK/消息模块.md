# 消息模块

## 接口定义

```dart
abstract class IMessageService {
  /// 发送文本消息
  Future<Message> sendTextMessage(String conversationId, String text);
  
  /// 发送图片消息
  Future<Message> sendImageMessage(String conversationId, List<int> imageData);
  
  /// 发送语音消息
  Future<Message> sendVoiceMessage(String conversationId, List<int> voiceData, int duration);
  
  /// 发送文件消息
  Future<Message> sendFileMessage(String conversationId, List<int> fileData, String fileName);
  
  /// 发送位置消息
  Future<Message> sendLocationMessage(String conversationId, Location location);
  
  /// 获取历史消息
  Future<List<Message>> getMessageHistory(String conversationId, {String? beforeMessageId, int limit = 20});
  
  /// 撤回消息
  Future<void> recallMessage(String messageId);
  
  /// 删除消息
  Future<void> deleteMessage(String messageId);
  
  /// 监听新消息
  Stream<Message> get onMessageReceived;
  
  /// 监听消息状态变化
  Stream<MessageStatusEvent> get onMessageStatusChanged;
}
```

---

## 数据类型

```dart
class Message {
  final String id;
  final String conversationId;
  final String senderId;
  final MessageType type;
  final MessageContent content;
  final MessageStatus status;
  final DateTime createdAt;
  final bool isRecalled;
}

enum MessageType { text, image, voice, video, file, location, system }

enum MessageStatus { sending, sent, delivered, read, failed }

// 消息内容
abstract class MessageContent {}

class TextContent extends MessageContent {
  final String text;
}

class ImageContent extends MessageContent {
  final String url;
  final String thumbnailUrl;
  final int width;
  final int height;
}

class VoiceContent extends MessageContent {
  final String url;
  final int duration; // 秒
}

class FileContent extends MessageContent {
  final String url;
  final String name;
  final int size; // 字节
}

class LocationContent extends MessageContent {
  final double latitude;
  final double longitude;
  final String address;
}

class Location {
  final double latitude;
  final double longitude;
  final String address;
}

class MessageStatusEvent {
  final String messageId;
  final MessageStatus status;
}
```
