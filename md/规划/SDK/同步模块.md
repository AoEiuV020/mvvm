# 同步模块

所属模块：`sdk-http`

## 接口定义

```dart
abstract class ISyncService {
  /// 同步所有数据，失败抛 SyncException
  Future<void> syncAll();
  
  /// 同步用户信息
  Future<void> syncUserInfo();
  
  /// 同步好友列表
  Future<void> syncFriends();
  
  /// 同步群组列表
  Future<void> syncGroups();
  
  /// 同步进度流
  Stream<SyncProgress> get progressStream;
}
```

---

## 数据类型

```dart
class SyncProgress {
  final SyncStage stage;
  final int current;
  final int total;
}

enum SyncStage {
  userInfo,
  friends,
  groups,
  complete,
}

class SyncException implements Exception {
  final SyncError error;
  SyncException(this.error);
}

enum SyncError {
  tokenExpired,
  networkError,
  serverError,
}
```

---

## 使用示例

```dart
// 监听同步进度
syncService.progressStream.listen((progress) {
  // 更新 UI：progress.stage, progress.current / progress.total
});

// 执行同步
try {
  await syncService.syncAll();
  // 同步完成，可进入主页
} on SyncException catch (e) {
  // 处理错误：e.error
}
```

---

## 说明

- 登录成功后调用
- 同步数据保存到本地数据库（sdk-db）
- 同步完成后可通过其他模块读取数据
